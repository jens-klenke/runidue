\PassOptionsToPackage{unicode=true$for(hyperrefoptions)$,$hyperrefoptions$$endfor$}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
$if(colorlinks)$
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
$endif$$if(dir)$$if(latex-dir-rtl)$
\PassOptionsToPackage{RTLdocument}{bidi}
$endif$$endif$%

\documentclass[$if(fontsize)$$fontsize$,$else$10pt,$endif$$if(lang)$$babel-lang$,$endif$$if(papersize)$$papersize$paper,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}

\usepackage{lmodern}

$if(linestretch)$
\usepackage{setspace}
\setstretch{$linestretch$}
$endif$
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\usepackage[utf8]{inputenc}





% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
  \usepackage{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

$if(geometry)$
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
$endif$

\usepackage{hyperref}
$if(colorlinks)$
\PassOptionsToPackage{usenames,dvipsnames}{color} % color is loaded by hyperref
$endif$
\hypersetup{unicode=true,
$if(title-meta)$
            pdftitle={$title-meta$},
$endif$
$if(author-meta)$
            pdfauthor={$author-meta$},
$endif$
$if(keywords)$
            pdfkeywords={$for(keywords)$$keywords$$sep$; $endfor$},
$endif$
            colorlinks=true,
            linkcolor=dueblue,
            citecolor=dueblue,
            urlcolor=dueblue,
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
$if(lang)$
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[shorthands=off,$for(babel-otherlangs)$$babel-otherlangs$,$endfor$main=$babel-lang$]{babel}
$if(babel-newcommands)$
  $babel-newcommands$
$endif$
\else
  \usepackage{polyglossia}
  \setmainlanguage[$polyglossia-lang.options$]{$polyglossia-lang.name$}
$for(polyglossia-otherlangs)$
  \setotherlanguage[$polyglossia-otherlangs.options$]{$polyglossia-otherlangs.name$}
$endfor$
\fi
$endif$
$if(natbib)$
\usepackage$if(natbiboptions)$[$for(natbiboptions)$$natbiboptions$$sep$,$endfor$]$endif${natbib}
\bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
$endif$
$if(biblatex)$
\usepackage$if(biblio-style)$[style=$biblio-style$]$endif${biblatex}
$if(biblatexoptions)$\ExecuteBibliographyOptions{$for(biblatexoptions)$$biblatexoptions$$sep$,$endfor$}$endif$
$for(bibliography)$
\addbibresource{$bibliography$}
$endfor$
$endif$
$if(listings)$
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
$endif$
$if(lhs)$
\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
$endif$
$if(highlighting-macros)$
$highlighting-macros$
$endif$
$if(verbatim-in-note)$
\usepackage{fancyvrb}
\VerbatimFootnotes % allows verbatim text in footnotes
$endif$
$if(tables)$
\usepackage{longtable,booktabs}
$endif$
$if(graphics)$
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$

$if(strikeout)$
\usepackage[normalem]{ulem}
% avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
$endif$
$if(indent)$
$else$
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
$endif$
\setlength{\emergencystretch}{3em}  % prevent overfull lines
$if(numbersections)$
\setcounter{secnumdepth}{5}
$else$
\setcounter{secnumdepth}{0}
$endif$
$if(subparagraph)$
$else$
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
$endif$
$if(dir)$
\ifxetex
  % load bidi as late as possible as it modifies e.g. graphicx
  $if(latex-dir-rtl)$
  \usepackage[RTLdocument]{bidi}
  $else$
  \usepackage{bidi}
  $endif$
\fi
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \TeXXeTstate=1
  \newcommand{\RL}[1]{\beginR #1\endR}
  \newcommand{\LR}[1]{\beginL #1\endL}
  \newenvironment{RTL}{\beginR}{\endR}
  \newenvironment{LTR}{\beginL}{\endL}
\fi
$endif$

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

$if(compact-title)$
%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
$endif$

$if(title)$
  \title{$title$}
  $if(compact-title)$
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  $endif$
$else$
  \title{}
  $if(compact-title)$
  \pretitle{\vspace{\droptitle}}
  \posttitle{}
  $endif$
$endif$
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
$if(author)$
  \author{$for(author)$$author$$sep$ \\ $endfor$}
  $if(compact-title)$
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  $endif$
$else$
  \author{}
  $if(compact-title)$
  \preauthor{}\postauthor{}
  $endif$
$endif$

\providecommand{\institute}[1]{}
\institute{\expandafter\ifstrequal\expandafter{$lang$}{de}{%
Universität Duisburg-Essen}{%
University of Duisburg-Essen}}%

$if(date)$
  $if(compact-title)$
  \predate{\centering\large\emph}
  \postdate{\par}
  $endif$
  \date{$date$}
$else$
  \date{}
  $if(compact-title)$
  \predate{}\postdate{}
  $endif$
$endif$






%%%%%%%%%%%%%%%%%%%% Added Code %%%%%%%%%%%%%%%%%%%%
%%% Packages
\input{includes/tex/ee.sty}
\usepackage{booktabs}
\usepackage[export]{adjustbox}
\usepackage{bbm,bm}
\usepackage{etoolbox}
\usepackage{ifthen}
\usepackage{textcomp}
\usepackage{booktabs}
\usepackage[skip=7pt]{caption} % space between floats (figures, tables) and its captions
\usepackage{tikz}
\usepackage{makecell}
\usepackage{subfig}

\AtBeginEnvironment{center}{\medskip}
\AtEndEnvironment{center}{\medskip}
\AtBeginEnvironment{itemize}{\smallskip}




%\newenvironment{arrange}{\medskip\begin{center}}{\end{center}\medskip}


\usepackage{zref}
\usepackage{zref-user}
\usepackage{zref-xr}
$if(zref-path)$
\zexternaldocument[S-]{$zref-path$}
\newcommand{\zeqref}[1]{(\zref{#1})}
$endif$


%%%

\makeatletter
\let\@@magyar@captionfix\relax
\makeatother


%%% Additional commands
\newcommand{\npt}{\\[1ex]\pause}
\newcommand{\nbs}{\protect{~}}
\newcommand{\qedb}{\hfill \textsquare} % to be used outside proof environments
\newcommand{\pausealt}{ }
\newcommand{\blue}[1]{{\color{dueblue}{#1}\color{black}}}
\newcommand{\hil}[1]{\textbf{\color{dueblue}{#1}\color{black}}}
\newcommand{\hilm}[1]{\mathbf{\color{dueblue}{#1}\color{black}}}
\newcommand{\GP}{\operatorname{GP}}
\newcommand{\GEV}{\operatorname{GEV}}
\newcommand{\di}{\mathrm{i}}
\makeatletter
\newcommand*\fsize{\dimexpr\f@size pt\relax} % returns current font size
\makeatother
\newcommand{\R}{\includegraphics[height=.85\fsize, clip=T]{includes/img/R_logo} }

\newcommand{\source}[1]{\scriptsize \textit{\expandafter\ifstrequal\expandafter{$lang$}{de}{Quelle: }{Source: }}#1}
%%% LAYOUT

% New colors
\definecolor{dueblue}{RGB}{0,76,147}
\definecolor{duelightblue}{RGB}{223,228,242}
\definecolor{duebeige}{RGB}{239,228,191}

% \usetheme{Boadilla}

\expandafter\ifstrequal\expandafter{$block-style$}{blank}{}{
\setbeamerfont{block title}{size=\normalsize}
\setbeamercolor{block title}{bg=duelightblue,fg=black}
\setbeamercolor{block body}{bg=duelightblue!37,fg=black}
}%

\setbeamertemplate{blocks}[rounded][shadow=false]



\usecolortheme[named=dueblue]{structure}
\beamertemplatenavigationsymbolsempty
\setbeamersize{text margin left=10pt, text margin right=10pt}



% LENGTHS
\setlength{\parindent}{0pt}
\setlength{\parskip}{2ex}
\setlength{\emergencystretch}{3em}  % prevent overfull lines

%%% Spacing around display equations
\makeatletter
\g@addto@macro\normalsize{%
  \setlength\abovedisplayskip{\medskipamount}
  \setlength\belowdisplayskip{\medskipamount}
  \setlength\abovedisplayshortskip{\medskipamount}
  \setlength\belowdisplayshortskip{\medskipamount}
}
\makeatother


% TOC
$if(startatzero)$ 
\makeatletter
\patchcmd{\beamer@sectionintoc}
  {\ifnum\beamer@tempcount>0}
  {\ifnum\beamer@tempcount>-1}
  {}
  {}
\beamer@tocsectionnumber=-1
\setcounter{section}{-1}
\makeatother
$endif$

\setbeamertemplate{section in toc shaded}[default][50]
\defbeamertemplate{section in toc}{customcircle}
{\leavevmode\leftskip=2ex%
  \llap{%
    \usebeamerfont*{section number projected}%
    \usebeamercolor{section number projected}%
    \begin{pgfpicture}{-1ex}{-.2ex}{1ex}{2ex}
      \color{bg}
      \pgfpathcircle{\pgfpoint{0pt}{.75ex}}{1.4ex}
      \pgfusepath{fill}
      \pgftext[base]{\color{fg}\inserttocsectionnumber}
    \end{pgfpicture}\kern1.25ex%
  }%
  \hspace{1ex}\inserttocsection\par}

\setbeamertemplate{section in toc}[customcircle]



% fix for: ! Undefined control sequence.
%          <argument> \@@magyar@captionfix
\makeatletter
\patchcmd{\beamer@sectionintoc}{\vskip1.5em}{\vskip0.05em}{}{}
\makeatother




% Frame Head
\makeatletter
\setbeamertemplate{frametitle}{%
\vspace{.1cm}
\begin{minipage}[t][1cm]{.84\textwidth}
    \ifbeamer@plainframe%
      \Large\insertframetitle%
    \else
      \Large\insertframetitle%
      \ifx\insertframesubtitle\empty
      \else
        \\ \small \insertframesubtitle
      \fi
    \fi
\end{minipage}\hfill
\begin{minipage}[t][1cm]{1.9cm}
\expandafter\ifstrequal\expandafter{$lang$}{de}{%
\includegraphics[width=2cm,keepaspectratio=true, valign=t]{includes/img/logo_german}}{%
\includegraphics[width=2cm,keepaspectratio=true, valign=t]{includes/img/logo_english}}%
\end{minipage}
\vspace{-.3cm}
}
\makeatother

% Footer
\setbeamertemplate{footline}{\hspace*{.1cm}%
\hfill \scriptsize{{\insertshortauthor : }
\insertshorttitle---\insertsection \hfill \thesection-\insertframenumber\hspace*{.2cm}}\vspace{1mm}}


% ITEMIZE, ENUMERATE and DESCRIPTION


\defbeamertemplate*{description item}{defaultperiod}{\insertdescriptionitem.}
\setbeamersize{description width=15pt} % left margin for description


\setlength{\leftmargini}{15pt}
\setlength{\leftmarginii}{15pt}
\setlength{\leftmarginiii}{15pt}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[triangle]
\setbeamertemplate{enumerate item}[default]
\setbeamertemplate{enumerate subitem}[default]
\setbeamertemplate{description item}[defaultperiod]
\setbeamertemplate{description subitem}[defaultperiod]

\providecommand{\tightlist}{\setlength{\itemsep}{1ex}\setlength{\parskip}{1.3ex}}




% NEW SECTION
\AtBeginSection[] {
{
\setbeamertemplate{footline}{}
\begin{frame}{\expandafter\ifstrequal\expandafter{$lang$}{de}{Überblick}{Outline}}
\vspace{0.5cm}
\tableofcontents[currentsection]
\end{frame}
\addtocounter{framenumber}{-\insertframenumber} % collect all begin section commands in one env.!
}
}




% BLOCK ENVIRONMENTS (THEOREMS)
% Headers for theorems
\expandafter\ifstrequal\expandafter{$lang$}{de}{%
  \newcommand{\thmncont}{Fortsetzung}
  \newtheorem{thmn}{Theorem}[section]
  \newtheorem{lem}[thmn]{Lemma}
  \newtheorem{cor}[thmn]{Corollary}
  \newtheorem{defn}[thmn]{Definition}
  \newtheorem{ass}[thmn]{Annahme}
  \newtheorem{rem}[thmn]{Anmerkung}
  \newtheorem{pro}[thmn]{Proposition}
  \theoremstyle{definition}
  \newtheorem{xmpl}[thmn]{Beispiel}
  \newtheorem{que}[thmn]{Frage}
  \numberwithin{equation}{section}}{%%%
  \newcommand{\thmncont}{Continued}
  \newtheorem{thmn}{Theorem}[section]
  \newtheorem{lem}[thmn]{Lemma}
  \newtheorem{cor}[thmn]{Corollary}
  \newtheorem{defn}[thmn]{Definition}
  \newtheorem{ass}[thmn]{Assumption}
  \newtheorem{rem}[thmn]{Remark}
  \newtheorem{pro}[thmn]{Proposition}
  \theoremstyle{definition}
  \newtheorem{xmpl}[thmn]{Example}
  \newtheorem{que}[thmn]{Question}
  \numberwithin{equation}{section}
}%


\setbeamertemplate{theorems}[numbered]
\setbeamerfont{block title}{size=\normalsize}
\setbeamertemplate{theorem begin}
{%
  \expandafter\ifstrequal\expandafter{\inserttheoremaddition}{*}{\addtocounter{thmn}{-1}}{}
  \normalfont
  \begin{\inserttheoremblockenv}{%
    \structure{%
      \textbf{\inserttheoremname \inserttheoremnumber}:
      \ifx\inserttheoremaddition\empty\else\expandafter\ifstrequal\expandafter{\inserttheoremaddition}{*}{\thmncont\inserttheorempunctuation}{\inserttheoremaddition\inserttheorempunctuation}\fi%
    }%
  }%
}
\setbeamertemplate{theorem end}{\leavevmode\end{\inserttheoremblockenv}}


% Kahoot Block
\newenvironment<>{kahoot}[1]{%
  \begin{actionenv}#2%
      \def\insertblocktitle{#1}%
      \par%
      \mode<presentation>{%
      \setbeamercolor{block title}{fg=black,bg=yellow}
       \setbeamercolor{block body}{fg=black,bg=yellow!20}
       \setbeamercolor{itemize item}{fg=orange!20!black}
       \setbeamertemplate{itemize item}[triangle]
     }%
      \usebeamertemplate{block begin}
      \begin{center}
\includegraphics[width=0.15\textwidth]{includes/img/kahoot.png}
\end{center}}
    {\par\usebeamertemplate{block end}\end{actionenv}}
\newcommand{\kahootblock}[1]{\begin{kahoot}{#1}\end{kahoot}}

% \makeatletter
% \def\newblock{\beamer@newblock} % to make bibtex work
% \makeatother


%%% Code chunks
% Spacing before and after code chunks / output
\makeatletter
\preto{\@verbatim}{\topsep=-2pt \partopsep=2pt \parskip=-2ex}
\preto{\Shaded}{\smallskip}{}
\makeatother
$if(shadecolor)$\definecolor{shadecolor}{gray}{$shadecolor$}$endif$ % shade of grey used for chunk background

% Other stuff
\usetikzlibrary{arrows, decorations.markings}
\tikzstyle{arrow} = [ultra thick, - latex, shorten >= 2pt, shorten <= 2pt] % default arrow
\tikzstyle{box} = [rectangle,rounded corners,fill=dueblue, text=white, align=center, node distance=1.25cm] % default node


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%















\begin{document}


$if(title)$
$if(towers)$
{\usebackgroundtemplate{\includegraphics[scale=0.25]{includes/img/due_tower}}
\frame[plain]{\titlepage}}
$else$
\frame[plain]{\titlepage}
$endif$
$endif$


$for(include-before)$
$include-before$

$endfor$
$if(toc)$
$if(toc-title)$
\renewcommand*\contentsname{$toc-title$}
$endif$
$if(beamer)$
\begin{frame}
$if(toc-title)$
\frametitle{$toc-title$}
$endif$
\tableofcontents[hideallsubsections]
\end{frame}
$else$
{
$if(colorlinks)$
\hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$$endif$}
$endif$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}
$endif$
$endif$
$if(lot)$
\listoftables
$endif$
$if(lof)$
\listoffigures
$endif$
$body$

$if(natbib)$
$if(bibliography)$
$if(biblio-title)$
$if(book-class)$
\renewcommand\bibname{$biblio-title$}
$else$
\renewcommand\refname{$biblio-title$}
$endif$
$endif$
$if(beamer)$
\begin{frame}[allowframebreaks]{$biblio-title$}
\bibliographytrue
$endif$
\bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
$if(beamer)$
\end{frame}
$endif$

$endif$
$endif$
$if(biblatex)$
$if(beamer)$
\begin{frame}[allowframebreaks]{$biblio-title$}
\bibliographytrue
\printbibliography[heading=none]
\end{frame}
$else$
\printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$
$endif$

$endif$
$for(include-after)$
$include-after$

$endfor$
\end{document}
